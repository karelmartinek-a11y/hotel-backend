{% extends "base.html" %}

{% set use_sidebar = true %}

{% block sidebar %}
  {% include "admin_sidebar.html" %}
{% endblock %}

{% block title %}ASC Hotel Chodov — Detail záznamu{% endblock %}

{% block head_extra %}{% endblock %}

{% block content %}
  <div class="kajovo-pagehead">
    <div>
      <h1>Detail záznamu</h1>
      <div class="kajovo-subtitle">Pokoj {{ report.room }} • ID {{ report.id }}</div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <a href="/admin/reports" class="kajovo-btn kajovo-btn--secondary">Zpět na seznam</a>
    </div>
  </div>

  <section class="kajovo-surface kajovo-card" style="display:grid;gap:14px;">
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      {% if report.type == "FIND" %}
        <span class="kajovo-badge kajovo-badge--info">Ztráty a nálezy</span>
      {% else %}
        <span class="kajovo-badge kajovo-badge--warning">Závady</span>
      {% endif %}

      {% if report.status == "OPEN" %}
        <span class="kajovo-badge kajovo-badge--active"><span class="kajovo-dot" aria-hidden="true"></span><span>OPEN</span></span>
      {% else %}
        <span class="kajovo-badge"><span class="kajovo-dot" aria-hidden="true"></span><span>DONE</span></span>
      {% endif %}
    </div>

    <div style="display:grid;gap:10px;">
      <div class="kajovo-meta-row">
        <div><strong>Vytvořeno:</strong> {{ report.created_at_human }}</div>
        <div><strong>Vyřízeno:</strong> {{ report.done_at_human or "—" }}</div>
        <div><strong>Doba:</strong> {% if report.duration_hours is not none %}{{ '%.1f'|format(report.duration_hours) }} h{% else %}—{% endif %}</div>
        <div><strong>Zařízení:</strong> {{ report.created_by_device_id }}</div>
      </div>

      <div class="kajovo-surface kajovo-card" style="background:#F8FAFC;border:1px solid var(--kajovo-border);box-shadow:none;">
        <div class="kajovo-subtitle" style="margin:0;">Popis</div>
        <div style="margin-top:6px;font-size:15px;">{{ report.description or "(bez popisu)" }}</div>
      </div>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      {% if report.status == "OPEN" %}
        <form method="post" action="/admin/reports/{{ report.id }}/done">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
          <button type="submit" class="kajovo-btn kajovo-btn--primary">Vyřízeno</button>
        </form>
      {% else %}
        <form method="post" action="/admin/reports/{{ report.id }}/reopen">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
          <button type="submit" class="kajovo-btn kajovo-btn--secondary">Reopen</button>
        </form>
      {% endif %}

      <form method="post" action="/admin/reports/{{ report.id }}/delete" onsubmit="return confirm('Opravdu smazat tento záznam včetně fotek?');">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <button type="submit" class="kajovo-btn kajovo-btn--critical">Smazat</button>
      </form>
    </div>

    <div class="kajovo-surface kajovo-card" style="background:#F8FAFC;border:1px solid var(--kajovo-border);box-shadow:none;">
      <div style="display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));">
        <div>
          <div class="kajovo-subtitle" style="margin:0;">ID</div>
          <div class="kajovo-mono">{{ report.id }}</div>
        </div>
        <div>
          <div class="kajovo-subtitle" style="margin:0;">Fotky</div>
          <div style="font-weight:700;">{{ report.photo_count }}</div>
        </div>
        {% if report.done_at_human %}
        <div>
          <div class="kajovo-subtitle" style="margin:0;">Vyřízeno</div>
          <div>{{ report.done_at_human }}</div>
        </div>
        {% endif %}
        {% if report.duration_hours is not none %}
        <div>
          <div class="kajovo-subtitle" style="margin:0;">Doba vyřízení</div>
          <div>{{ '%.1f'|format(report.duration_hours) }} h</div>
        </div>
        {% endif %}
        {% if report.done_by_device_id %}
        <div>
          <div class="kajovo-subtitle" style="margin:0;">Vyřídil</div>
          <div>{{ report.done_by_device_id }}</div>
        </div>
        {% endif %}
      </div>
    </div>

    {% if report.photos and report.photos|length > 0 %}
      <div style="display:grid;gap:10px;">
        <div style="font-weight:750;">Fotky</div>
        <div class="kajovo-photo-grid">
          {% for p in report.photos %}
            <a class="kajovo-photo" href="/admin/reports/{{ report.id }}/photos/{{ p.id }}" target="_blank" rel="noopener">
              <img src="/admin/reports/{{ report.id }}/photos/{{ p.id }}" alt="Foto {{ loop.index }}" loading="lazy" />
            </a>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </section>
{% endblock %}
